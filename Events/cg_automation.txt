namespace = cg_automation
country_event = {
    id = cg_automation.1
    hide_window = yes
    is_triggered_only = yes
	trigger = {
		NOT = { has_policy_flag =  resettlement_not_allowed }
		OR = {
			NOT = { has_policy_flag = eac_apm_no }
		}
		any_owned_planet = {
			is_occupied_flag = no
			any_owned_pop_group = { is_unemployed = yes }
		}
		any_owned_planet = {
			free_housing > 100
			
			OR = {
				num_unemployed = 0
				has_avaible_job_specialist = yes
				has_avaible_job_worker = yes
			}
		}
		OR = {
			# AND = {
			# 	has_policy_flag =  resettlement_limited 
			# 	has_country_resource = { type = energy amount > 1500}
			# }
			AND = {
				OR = {
					has_policy_flag =  resettlement_allowed 
					has_ethic = "ethic_gestalt_consciousness"
				}
				has_country_resource = { type = energy amount > 500}
			}
		}
		resource_income_compare = {
			resource = energy
			value > 1
		}
		has_country_resource = { type = unity amount > 100 }
	}
    immediate = {
		every_owned_planet = { # search planet for reduce variable recently_resettle_in
			limit = {
				check_variable = {
					which = recently_resettle_in #not recently resettle
					value > 0
				}
				
			}
			change_variable = { which = recently_resettle_in value = -1 }
		}
        every_owned_planet = { # search planet by start resettle
            limit = {
                any_owned_pop_group = { is_unemployed = yes }
                has_orbital_bombardment = no
				is_occupied_flag = no
				owner = { 
					OR = {
						# AND = {
						# 	has_policy_flag =  resettlement_limited 
						# 	has_country_resource = { type = energy amount > 1500}
						# }
						AND = {
							OR = {
								has_policy_flag =  resettlement_allowed 
								has_ethic = "ethic_gestalt_consciousness"
							}
							has_country_resource = { type = energy amount > 500}
						}
					}
					has_country_resource = { type = unity amount > 100 }
				}
				check_variable = {
					which = recently_resettle_in # if recently resettle by automation will no send resettle for months.
					value = 0
				}
				NOT = { has_planet_flag = new_colony } # not new colony
            }
            #log = "-- Planet: [This.GetName]"
            random_owned_pop_group = {
				limit = {
					NOT = { is_pop_category = ruler } # ruler never move.
					Or = {
						is_pop_category = civilian
						is_unemployed = yes #4.0 is_unemlployed can't resettle
					}
					NOT = { has_citizenship_type = { type = citizenship_assimilation } } # Ignore assimilating pops
					# owner = { 
					# 	has_country_resource = { type = energy amount > 500 mult = value:pop_resettlement_cost } 
					# }
                     # minimum of 1K energy to move pops
                    OR = {
                        has_migration_control = {
                            type = no
                        }
                        pop_group_has_trait = trait_machine_unit 
                        pop_group_has_trait = trait_mechanical 
                        # species = { has_trait = trait_machine_unit }
                        # species = { has_trait = trait_mechanical }
                    }
				}
				# weights = {
				# 	modifier = {
				# 		factor = 2
				# 		is_pop_category = civilian
				# 	}
				# }
				cg_resettle_pop = yes # resettle pop in other planet
				
			}
		}
    } 
}
# check_variable = {
# 	which = recently_resettle_in
# 	value = 1
# }
# check_variable = {
# 	which = recently_resettle_in
# 	value = 0
# }
# set_variable = { which = recently_resettle_in value = 12 }
# set_variable = { which = recently_resettle_in value = 0 }


planet_event = {
    id = cg_automation.10
    hide_window = yes
    is_triggered_only = yes
	immediate = {
		random_owned_pop_group = {
			save_event_target_as = random_pop_automation
			#event_target:looted_planet.value:farming_districts_value
		}
		while = {
			count = 10
				if = { 
					limit = { 
						owner = {
							resource_stockpile_compare = {
								resource = energy
								value > 500
								mult = event_target:random_pop_automation.value:pop_resettlement_cost
							}
							OR = {
								has_valid_civic = civic_corvee_system
								resource_stockpile_compare = {
									resource = unity
									value > 50
									mult = event_target:random_pop_automation.value:pop_resettlement_cost
								}
							}
						}
					}
				random_owned_pop_group = {
					cg_try_move_pop_planet = yes
					weights = {
						base = 1
						modifier = {
							factor = 100
							is_unemployed = yes
						}
						modifier = {
							factor = 2
							is_pop_category = specialist
						}
						modifier = {
							factor = 3
							is_pop_category = worker
						}
						modifier = {
							factor = 2
							is_pop_category = complex_drone
						}
						modifier = {
							factor = 3
							is_pop_category = simple_drone
						}
						modifier = {
							factor = 3
							is_pop_category = robot_servant
						}
					}
				}
			}
		}
	}
}
planet_event = {
    id = cg_automation.20
    hide_window = yes
    is_triggered_only = yes
	immediate = {
		while = {
			count = 20
			if = { 
				limit = { 
					owner = {
						resource_stockpile_compare = {
							resource = energy
							value > 500
							mult = event_target:random_pop_automation.value:pop_resettlement_cost
						}
						OR = {
							has_valid_civic = civic_corvee_system
							resource_stockpile_compare = {
								resource = unity
								value > 50
								mult = event_target:random_pop_automation.value:pop_resettlement_cost
							}
						}
					}
				}
				random_owned_pop_group = {
					cg_try_move_pop_planet = yes
					weights = {
						base = 1
						modifier = {
							factor = 100
							is_unemployed = yes
						}
						modifier = {
							factor = 3
							is_pop_category = specialist
						}
						modifier = {
							factor = 10
							is_pop_category = worker
						}
						modifier = {
							factor = 3
							is_pop_category = complex_drone
						}
						modifier = {
							factor = 10
							is_pop_category = simple_drone
						}
						modifier = {
							factor = 10
							is_pop_category = robot_servant
						}
					}
				}
			}
		}
	}
}