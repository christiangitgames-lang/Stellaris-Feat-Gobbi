namespace = sfg_ai
#@b1_1_minerals = 400;
@b1_2_minerals = 200; #200-400
@b1_3_minerals = 400; #300-400
# EXPLAINER:
#	sfg_ai.0 yearly checker auto remove district building and build districts
# have recycle code of mariominaccia
#by .10 new code from gobbi
#sfg_ai.10 add alloys and influence lost for fleet disabled
#sfg_ai.20-29 start vital building 
event = { #standard
	id = sfg_ai.0
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = yes
		OR = {
			average_empire = yes #standard empire
			spiritualistic_empire = yes #spiritualista gestito
		}
		has_resource = { type = minerals amount > 500 }
		OR = {
			has_resource = { type = energy amount > 1000 }
			has_monthly_income = { resource = energy value > 20 }
		}
		NOT = { has_global_flag = AI_easy }
	}
	
	immediate = {
		random_owned_planet = {
			planet_event = { #	cg_ai.42	Universally  remove buildings
				id = sfg_ai.1
				#days = 4 #Alleggerisce il carico nelle multiplayer
			}
			planet_event = { #	cg_ai.42	Universally  remove districts
				id = sfg_ai.2
				days = 180 #Alleggerisce il carico nelle multiplayer
			}
		}
	}
}
planet_event = { #	cg_ai.1	Universally  remove buildings
	id = sfg_ai.1
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		owner = {
			is_ai = yes
			is_country_type = default
		}
		OR = {
			has_resource = { type = energy amount > 1000 }
		}
		NOT = { has_global_flag = AI_easy }
	}
	
	immediate = {
		if = { 
			limit = { 
				has_building = building_hydroponics_farm 
				owner = {
					OR = {
						OR = {
							has_monthly_income = { resource = food value > 50 } 
							AND = {
								country_uses_bio_ships = yes
								has_monthly_income = { resource = food value > 100 } 
							}
						}
						AND = { 
							country_uses_bio_ships = no
							has_resource = {
								type = food
								amount > 2500
							} 
							has_monthly_income = { resource = food value > 0 } 
						}
					}
				} 
			}
			remove_building = building_hydroponics_farm 
			owner = { add_resource = { minerals = @b1_minerals mult = prev.value:planet_building_refund_mult } } #da testare
		}
		#military
		else_if = { limit = { owner = { used_naval_capacity_percent <= 0.5 militaristic_empire = no } has_building = building_stronghold } remove_building = building_stronghold }
		else_if = { limit = { owner = { used_naval_capacity_percent <= 0.5 militaristic_empire = no } has_building = building_fortress } remove_building = building_fortress }
		else_if = { limit = { owner = { used_naval_capacity_percent <= 0.5 militaristic_empire = no } has_building = building_dread_encampment } remove_building = building_dread_encampment }
		else_if = { limit = { owner = { used_naval_capacity_percent <= 0.5 militaristic_empire = no } has_building = building_planetary_shield_generator } remove_building = building_planetary_shield_generator }
		#luxury
		else_if = { limit = { free_amenities > 3000 has_building = building_luxury_residence } remove_building = building_luxury_residence }
		else_if = { limit = { free_amenities > 7000 has_building = building_paradise_dome } remove_building = building_paradise_dome owner = { add_resource = { minerals = @b1_2_minerals rare_crystals = @b2_rare_cost mult = prev.value:planet_building_refund_mult } } }
		#resource
		#else_if = { limit = { has_building = building_commercial_zone owner = { has_monthly_income = { resource = energy value > 70 } } } remove_building = building_commercial_zone }
		
		else_if = { limit = { has_building = building_holo_theatres free_amenities > 3000 } remove_building = building_holo_theatres }#test
		#factory
		else_if = { limit = { has_building = building_factory_1 owner = { has_monthly_income = { resource = consumer_goods value > 25 } } } remove_building = building_factory_1 }
		else_if = { limit = { has_building = building_factory_2 owner = { has_monthly_income = { resource = consumer_goods value > 100 } } } remove_building = building_factory_2 owner = { add_resource = { minerals = @b1_2_minerals rare_crystals = @b2_rare_cost mult = prev.value:planet_building_refund_mult } } }
		else_if = { limit = { has_building = building_factory_3 owner = { has_monthly_income = { resource = consumer_goods value > 150 } } } remove_building = building_factory_3 owner = { add_resource = { minerals = @b1_3_minerals rare_crystals = @b2_rare_cost mult = prev.value:planet_building_refund_mult } } }
		else_if = { limit = { owner = { militaristic_empire = no } has_building = building_foundry_1 owner = { has_monthly_income = { resource = alloys value > 100 } } } remove_building = building_foundry_1 }
		#rare resource
		else_if = { limit = { has_building = building_crystal_plant owner = { has_monthly_income = { resource = rare_crystals value > 3 } } } remove_building = building_crystal_plant }
		else_if = { limit = { has_building = building_chemical_plant owner = { has_monthly_income = { resource = volatile_motes value > 3 } } } remove_building = building_chemical_plant }
		else_if = { limit = { has_building = building_refinery owner = { has_monthly_income = { resource = exotic_gases value > 3 } } } remove_building = building_refinery }
		#clinics
		#else_if = { limit = { has_building = building_medical_1 free_amenities > 0 } remove_building = building_medical_1 }
		else_if = { limit = { has_building = building_medical_2 free_amenities > 3000 } remove_building = building_medical_2 }
		else_if = { limit = { has_building = building_medical_3 free_amenities > 4000 } remove_building = building_medical_3 }
		#research
		#else_if = { limit = { has_building = building_research_lab_1 } remove_building = building_research_lab_1 }
		#else_if = { limit = { has_building = building_research_lab_2 } remove_building = building_research_lab_2 owner = { add_resource = { minerals = @b1_2_minerals exotic_gases = @b2_rare_cost mult = prev.value:planet_building_refund_mult } } }
		
		owner = { add_resource = { minerals = @b1_minerals mult = prev.value:planet_building_refund_mult } } #da testare
		#TO DO rimuovere administration building e temple SE ha 3 ascension perk o perde energia/cg e ha meno di 100 energia/cg.
		#if = { limit = { free_building_slots > 0 }
			#owner = { add_resource = { minerals = @b1_minerals mult = prev.value:planet_building_refund_mult } } #da testare
			#inline_script = "building_add/universalwr"
			#add_modifier = { modifier = cg_ai_deficit_work_out_1 years = 1 }
		#}
	}
}
planet_event = { #	cg_ai.2	Universally  remove Districts
	id = sfg_ai.2
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_regular_planet_type = yes #non gestito pianeti speciali... troppo difficile
		owner = {
			is_ai = yes
			is_country_type = default
		}
		NOT = { has_global_flag = AI_easy }
	}
	
	immediate = {
			random_list = {
				
				100 = {
					remove_district = district_mining
					set_variable = {
 						which = from_d
                    	value = 0
					}
					inline_script = "district_add/universalwr" #universal add district 
					add_modifier = { modifier = sfg_ai_2 days = 180 }
					modifier = {
						factor = 3
						has_building = building_energy_grid
					}
					modifier = {
						factor = 5
						has_building = building_energy_nexus
					}
					modifier = {
						factor = 0
						OR = {
							NOT = { has_district = district_mining }
							owner = { has_monthly_income = { resource = minerals value < 100 } }
							AND = {
								food_planet = yes
								num_districts = { type = district_farming value = 1 }
							}
						}
					}
				
				}
				100 = {
					remove_district = district_generator
					set_variable = {
 						which = from_d
                    	value = 1
					}
					inline_script = "district_add/universalwr" #universal add district 
					add_modifier = { modifier = sfg_ai_2 days = 180 }
					modifier = {
						factor = 0
						OR = {
							has_building = building_energy_grid
							has_building = building_energy_nexus
						}
					}
					modifier = {
						factor = 0
						OR = {
							NOT = { has_district = district_generator }
							owner = { has_monthly_income = { resource = energy value < 75 }  }
							AND = {
								energy_planet = yes
								num_districts = { type = district_generator value = 1 }
							}
						}
					}
					
				}
				100 = {
					remove_district = district_farming
					set_variable = {
 						which = from_d
                    	value = 2
					}
					inline_script = "district_add/universalwr" #universal add district 
					add_modifier = { modifier = sfg_ai_2 days = 180 }
					modifier = {
						factor = 3
						has_building = building_energy_grid
					}
					modifier = {
						factor = 5
						has_building = building_energy_nexus
					}
					modifier = {
						factor = 0
						OR = {
							NOT = { has_district = district_farming }
							owner = { has_monthly_income = { resource = food value < 50 }  }
							AND = {
								mineral_planet = yes
								num_districts = { type = district_mining value = 1 }
							}
						}
					}
					
				}
				1 = {

				}
			}
			# if = { limit = { has_district = district_mining owner = { has_monthly_income = { resource = minerals value > 100 } } } remove_district = district_mining }
			# else_if = { limit = { has_district = district_generator owner = { has_monthly_income = { resource = energy value > 75 } } } remove_district = district_generator }
			# else_if = { limit = { has_district = district_farming owner = { has_monthly_income = { resource = food value > 50 } } } remove_district = district_farming }
			#else_if = { limit = { has_district = district_industrial owner = { has_monthly_income = { resource = consumer_goods value > 25 } } } remove_district = district_industrial }
			
	}
}
country_event = { #add alloys and influence lost for fleet disabled
	id = sfg_ai.10
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		owner = {
			is_ai = yes
			is_country_type = default
		}
	}
	immediate = {
		country_event = { #	cg_ai.42	Universally  remove buildings
			id = sfg_ai.11
			days = 30 #Alleggerisce il carico nelle multiplayer
		}
	}
}
country_event = { #add alloys and influence lost for fleet disabled
	id = sfg_ai.11
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		owner = {
			is_ai = yes
			is_country_type = default
		}
	}
	immediate = {
		if = {
			limit = {
				has_global_flag = AI_easy
			}
			add_resource = {
				alloys = 200
			}
		}
		else_if = {
			limit = {
				has_global_flag = AI_medium
			}
			add_resource = {
				alloys = 200
				influence = 100
			}
		}
		else_if = {
			limit = {
				has_global_flag = AI_hard
			}
			add_resource = {
				minerals = 800
				influence = 200
			}
		}
		
	}
}
country_event = { #gestione unity
	id = sfg_ai.20
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = yes
		OR = {
			average_empire = yes
			spiritualistic_empire = yes #spiritualista gestito
		}
	}
	immediate = {
		random_owned_planet = {
			limit = { is_capital = yes }
			planet_event = { 
				id = sfg_ai.21
				days = 360
			}
			planet_event = {
				id = sfg_ai.21
				days = 720
			}
		}
	}
}
planet_event = { #sfg_ai.21 gestione unity iniziale
	id = sfg_ai.21
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		owner = {
			is_ai = yes
			is_country_type = default
		}
	}
	immediate = {
		if = {
			limit = {
				NOT = {
					owner = {
						has_resource = { type = minerals amount >= 400 }
						has_monthly_income = { type = minerals amount >= 1 }
						has_monthly_income = { type = energy amount >= 4 }
						has_monthly_income = { type = consumer_goods amount >= 4 }
					}
				}
			}
			planet_event = {
				id = sfg_ai.21
				days = 720
			}
		}
		else = {
			if = {
				limit = {
					owner = { spiritualistic_empire = yes }
				}
				add_building = building_temple
				add_modifier = { modifier = sfg_ai_unity_21 years = 1 }
				
			}
			else = {
				add_building = building_bureaucratic_1
				add_modifier = { modifier = sfg_ai_unity_21 years = 1 }
			}
			owner = { add_resource = { minerals = @b1_minerals mult = -1 } }
		}
		
	}
}
