@demotionTime = 36
cg_resettlement_cost_by_gobbi = {
    #log = "---- This [This.GetName] "
    switch = {
        trigger = is_pop_category
        ruler = {
            owner = { 
                add_resource = { energy = -500 mult = prev.value:pop_resettlement_cost } 
                if = { limit = { NOT = { has_valid_civic = civic_corvee_system } }
                    add_resource = { unity = -50 mult = prev.value:pop_resettlement_cost } 
                }
            }
        }
        specialist = {
            #150
            owner = { 
                add_resource = { energy = -250 mult = prev.value:pop_resettlement_cost } 
                if = { limit = { NOT = { has_valid_civic = civic_corvee_system } }
                        add_resource = { unity = -25 mult = prev.value:pop_resettlement_cost } 
                }
            }

        }
        worker = {
            #100
            owner = { 
                add_resource = { energy = -100 mult = prev.value:pop_resettlement_cost } 
                if = { limit = { NOT = { has_valid_civic = civic_corvee_system } }
                    add_resource = { unity = -10 mult = prev.value:pop_resettlement_cost } 
                }
            }
        }
        complex_drone = {
            #100
            owner = { 
                add_resource = { energy = -100 mult = prev.value:pop_resettlement_cost } 
                if = { limit = { 
                        NOR = {
                            has_valid_civic = civic_machine_ota_updates
                            has_valid_civic = civic_hive_subsumed_will
                        }
                    }
                    add_resource = { unity = -10 mult = prev.value:pop_resettlement_cost } 
                }
            }
        }
        simple_drone = {
            #100
            owner = { 
                add_resource = { energy = -100 mult = prev.value:pop_resettlement_cost } 
                if = { limit = { 
                    NOR = {
                        has_valid_civic = civic_machine_ota_updates
                        has_valid_civic = civic_hive_subsumed_will
                    }
                }
                add_resource = { unity = -10 mult = prev.value:pop_resettlement_cost } 
            }
        }
        }
        robot_servant = {
            #100
            owner = { 
                add_resource = { energy = -100 mult = prev.value:pop_resettlement_cost } 
            }
        }
        slave = {
            #50
            owner = { 
                add_resource = { energy = -50 mult = prev.value:pop_resettlement_cost } 
            }
        }
        bio_trophy = {
            #100
            owner = { 
                add_resource = { energy = -50 mult = prev.value:pop_resettlement_cost } 
                add_resource = { unity = -25 mult = prev.value:pop_resettlement_cost } 
            }
        }
        default = {
            owner = { add_resource = { energy = -150 mult = prev.value:pop_resettlement_cost} }
        }
    }
}
# THIS - pop
# PREV - planet
# PREVPREV - owner ?
cg_resettle_pop = {
    #log = "eac_apm_find_new_home"
    #OWNER = { set_variable = { which = planet_found value = 0 } }
    if = { limit = { PREVPREV = { has_policy_flag = eac_apm_habitability_80 } }
        cg_try_move_pop_planet_preferred_hab_80 = yes
    }
    else_if = { limit = { owner = { has_policy_flag = eac_apm_habitability_60 } }
        cg_try_move_pop_planet_preferred_hab_60 = yes
    }
    else_if = { limit = { 
            owner = { 
                OR = {
                    has_policy_flag = eac_apm_habitability_40 
                }
            } 
        }
        cg_try_move_pop_planet_preferred_hab_40 = yes
    }
}
cg_try_move_pop_planet_preferred_hab_80 = {
    owner = { #coutry
        
        random_owned_planet = {
            limit = {
                NOT = { is_same_value = PREVPREVPREV }# PREVPREVPREV planet?
                habitability = { who = PREVPREV value >= 0.8 }
                OR = {
                    num_unemployed = 0
                    has_avaible_job_specialist = yes
                    has_avaible_job_worker = yes
			    }
                is_occupied_flag = no
            }
            
           
            inline_script = "resettle_pop/resettle_weights"
            resettle_pop_group = {POP_GROUP = PREVPREV PLANET = this AMOUNT = 100 }
            #log = "---- New Planet Preferred: [This.GetName]"
            PREVPREV = { cg_resettlement_cost_by_gobbi = yes }
            set_variable = { which = recently_resettle_in value = @demotionTime } #12 months for chance pop find new work
        }
    }
}

cg_try_move_pop_planet_preferred_hab_60 = {
    owner = { #coutry
        
        random_owned_planet = {
            limit = {
                NOT = { is_same_value = PREVPREVPREV }# PREVPREVPREV planet?
                habitability = { who = PREVPREV value >= 0.6 }
                OR = {
                    num_unemployed = 0
                    has_avaible_job_specialist = yes
                    has_avaible_job_worker = yes
			    }
                is_occupied_flag = no
            }
            
            inline_script = "resettle_pop/resettle_weights"
            resettle_pop_group = {POP_GROUP = PREVPREV PLANET = this AMOUNT = 100 }
            #log = "---- New Planet Preferred: [This.GetName]"
            PREVPREV = { cg_resettlement_cost_by_gobbi = yes }
            set_variable = { which = recently_resettle_in value = @demotionTime } #12 months for chance pop find new work
        }
    }
}

cg_try_move_pop_planet_preferred_hab_40 = {
    owner = { #coutry?
    #prev pop
        random_owned_planet = {#this planet # prev country? # prevprev pop # prevprev planet start
            limit = {
                NOT = { is_same_value = PREVPREVPREV }# PREVPREV planet
                habitability = { who = PREVPREV value >= 0.4 }
                OR = {
                    num_unemployed = 0
                    has_avaible_job_specialist = yes
                    has_avaible_job_worker = yes
			    }
                is_occupied_flag = no
            }
            inline_script = "resettle_pop/resettle_weights"
            resettle_pop_group = {POP_GROUP = PREVPREV PLANET = this AMOUNT = 100 }
            #log = "---- New Planet Preferred: [This.GetName]"
            PREVPREV = { cg_resettlement_cost_by_gobbi = yes }
            set_variable = { which = recently_resettle_in value = @demotionTime } #30 months for chance pop find new work
        }
    }
}
cg_try_move_pop_planet = { #is for decision resettle 10
    owner = { #coutry?
    #prev pop
        random_owned_planet = {#this planet # prev country? # prevprev pop # prevprev planet start
            limit = {
                NOT = { is_same_value = PREVPREVPREV }# PREVPREV planet
                habitability = { who = PREVPREV value >= 0.1 }
                is_occupied_flag = no
            }
            inline_script = "resettle_pop/resettle_weights_with_hab" #weight with hab
            resettle_pop_group = {POP_GROUP = PREVPREV PLANET = this AMOUNT = 100 }
            
            #log = "---- New Planet Preferred: [This.GetName]"
            PREVPREV = { cg_resettlement_cost_by_gobbi = yes }
            set_variable = { which = recently_resettle_in value = @demotionTime } #30 months for chance pop find new work
        }
    }
}

#for cg_ai.61
cg_resettle_pop_for_stab = {
    owner = { #coutry?
    #prev pop
        random_owned_planet = {#this planet # prev country? # prevprev pop # prevprev planet start
            limit = {
                NOT = { is_same_value = PREVPREVPREV }# PREVPREV planet
                planet_stability < 40
                habitability = { who = PREVPREV value >= 0.4 }
                num_unemployed = 0
                has_orbital_bombardment = no
                is_occupied_flag = no
            }
            inline_script = "resettle_pop/resettle_weights_stab"
            resettle_pop_group = {POP_GROUP = PREVPREV PLANET = this AMOUNT = 100 }
            #log = "---- New Planet Preferred: [This.GetName]"
            PREVPREV = { cg_resettlement_cost_by_gobbi = yes }
            set_variable = { which = recently_resettle_in value = @demotionTime } #30 months for chance pop find new work
            weights = {
                base = 1
                modifier = {
                    factor = 2
                    planet_stability < 30
                }
                modifier = {
                    factor = 2
                    planet_stability < 20
                }
            }
        }
    }
}